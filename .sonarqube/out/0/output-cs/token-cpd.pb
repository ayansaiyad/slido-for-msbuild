©5
[C:\Users\ayan.saiyad\Desktop\MSBuild\Sonar\slido-for-msbuild\src\Tasks\ChangeFileVersion.cs
	namespace 	
Slido
 
. 
Build 
{ 
public 

class 
ChangeFileVersion "
:# $
Task% )
{		 
[

 	
Required

	 
]

 
public 
	ITaskItem 
[ 
] 
Files  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
MsiPath 
{ 
get  #
;# $
set% (
;( )
}* +
public 
override 
bool 
Execute $
($ %
)% &
{ 	
try 
{ 
if 
( 
string 
. 
IsNullOrEmpty (
(( )
MsiPath) 0
)0 1
)1 2
{ 
Log 
. 
LogError  
(  !
$str! N
)N O
;O P
return 
false  
;  !
} 
if 
( 
Files 
== 
null !
||" $
Files% *
.* +
Length+ 1
==2 4
$num5 6
)6 7
{ 
Log 
. 

LogWarning "
(" #
$str# K
)K L
;L M
return 
true 
;  
} 
Log 
. 

LogMessage 
( 
MessageImportance 0
.0 1
Normal1 7
,7 8
$"9 ;
$str; a
{a b
MsiPathb i
}i j
$strj k
"k l
)l m
;m n
using 
( 
var 
database #
=$ %
new& )
Database* 2
(2 3
MsiPath3 :
,: ;
DatabaseOpenMode< L
.L M
TransactM U
)U V
)V W
{ 
foreach   
(   
var    
file  ! %
in  & (
Files  ) .
)  . /
{!! 
var"" 
fileName"" $
=""% &
file""' +
.""+ ,
ItemSpec"", 4
;""4 5
var## 
version## #
=##$ %
file##& *
.##* +
GetMetadata##+ 6
(##6 7
$str##7 @
)##@ A
;##A B
Log%% 
.%% 

LogMessage%% &
(%%& '
MessageImportance%%' 8
.%%8 9
High%%9 =
,%%= >
$"%%? A
$str%%A Q
{%%Q R
version%%R Y
}%%Y Z
$str%%Z h
{%%h i
fileName%%i q
}%%q r
$str%%r s
"%%s t
)%%t u
;%%u v
if'' 
('' 
string'' "
.''" #
IsNullOrEmpty''# 0
(''0 1
version''1 8
)''8 9
)''9 :
{(( 
Log)) 
.))  

LogWarning))  *
())* +
$"))+ -
$str))- S
{))S T
fileName))T \
}))\ ]
$str))] ^
"))^ _
)))_ `
;))` a
continue** $
;**$ %
}++ 
if-- 
(-- 
UpdateFileVersion-- -
(--- .
database--. 6
,--6 7
fileName--8 @
,--@ A
version--B I
)--I J
)--J K
{.. 
Log// 
.//  

LogMessage//  *
(//* +
MessageImportance//+ <
.//< =
High//= A
,//A B
$"//C E
$str//E P
{//P Q
fileName//Q Y
}//Y Z
$str//Z j
{//j k
version//k r
}//r s
$str//s t
"//t u
)//u v
;//v w
}00 
else11 
{22 
Log33 
.33  

LogWarning33  *
(33* +
$"33+ -
$str33- K
{33K L
fileName33L T
}33T U
$str33U V
"33V W
)33W X
;33X Y
}44 
}55 
database66 
.66 
Commit66 #
(66# $
)66$ %
;66% &
}77 
Log99 
.99 

LogMessage99 
(99 
MessageImportance99 0
.990 1
Normal991 7
,997 8
$str999 d
)99d e
;99e f
return:: 
true:: 
;:: 
};; 
catch<< 
(<< 
	Exception<< 
ex<< 
)<<  
{== 
Log>> 
.>> 
LogError>> 
(>> 
$">> 
$str>> <
{>>< =
ex>>= ?
.>>? @
Message>>@ G
}>>G H
">>H I
)>>I J
;>>J K
return?? 
false?? 
;?? 
}@@ 
}AA 	
privateCC 
boolCC 
UpdateFileVersionCC &
(CC& '
DatabaseCC' /
databaseCC0 8
,CC8 9
stringCC: @
fileNameCCA I
,CCI J
stringCCK Q
versionCCR Y
)CCY Z
{DD 	
tryEE 
{FF 
varGG 
sqlGG 
=GG 
$strGG L
;GGL M
usingII 
varII 
viewII 
=II  
databaseII! )
.II) *
OpenViewII* 2
(II2 3
sqlII3 6
)II6 7
;II7 8
usingJJ 
varJJ 
recordJJ  
=JJ! "
newJJ# &
RecordJJ' -
(JJ- .
$numJJ. /
)JJ/ 0
;JJ0 1
recordKK 
[KK 
$numKK 
]KK 
=KK 
versionKK #
;KK# $
recordLL 
[LL 
$numLL 
]LL 
=LL 
fileNameLL $
;LL$ %
viewNN 
.NN 
ExecuteNN 
(NN 
recordNN #
)NN# $
;NN$ %
returnOO 
trueOO 
;OO 
}PP 
catchQQ 
(QQ 
	ExceptionQQ 
exQQ 
)QQ  
{RR 
LogSS 
.SS 
LogErrorSS 
(SS 
$"SS 
$strSS ?
{SS? @
fileNameSS@ H
}SSH I
$strSSI K
{SSK L
exSSL N
.SSN O
MessageSSO V
}SSV W
"SSW X
)SSX Y
;SSY Z
returnTT 
falseTT 
;TT 
}UU 
}VV 	
}WW 
}XX 